'use strict';
// tests for posts
// Generated by serverless-mocha-plugin

const mod = require('../posts/index');
const mochaPlugin = require('serverless-mocha-plugin');

const wrapper = mochaPlugin.lambdaWrapper;
const expect = mochaPlugin.chai.expect;

// process.env.SERVERLESS_STAGE = 'dev';
// process.env.SERVERLESS_PROJECT = 'mpu-serverless-blog';

const wrapped = wrapper.wrap(mod, { handler: 'handler' });

describe('posts', () => {
  let postId;
  it('creates a post', (done) => {
    wrapped.run({
      method: 'POST',
      body: {
        title: 'Test post',
        content: 'Test content',
      },
    }, (err, response) => {
      if (err) {
        return done(err);
      }

      postId = response.post.id;
      expect(response.post.id).to.be.not.null;
      expect(err).to.be.null;
      return done();
    });
  });

  it('deletes a post', (done) => {
    wrapped.run({
      method: 'DELETE',
      path: {
        id: postId,
      },
    }, (err) => {
      expect(err).to.be.null;
      return done();
    });
  });
});
